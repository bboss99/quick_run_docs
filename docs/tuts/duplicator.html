

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-197011172-3', 'auto');
    ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->


  <title>Duplicator &mdash; Quick Run Docs 1.0.0 documentation</title>
  


  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tooltip Images" href="../common/toolTipImages.html" />
    <link rel="prev" title="Turntable Camera" href="turn_around_camera.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Quick Run Docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/Installation.html">Download/Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_run_free.html">Quick Run Free</a></li>
</ul>
<p class="caption"><span class="caption-text">tuts</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basic Scripts (No UI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="boss_ui.html">Boss UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="array_modifier.html">Array Modifier Grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="rename_selected.html">Rename Selected objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="turn_around_camera.html">Turntable Camera</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Duplicator</a></li>
</ul>
<p class="caption"><span class="caption-text">More Features and Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../common/toolTipImages.html">Tooltip Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/naming_conventions.html">Naming Convention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/convert_script_to_addon.html">Convert Script To Addon</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Run</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qr/qr_introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/quick_run.html">Quick Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/menu.html">Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/change_root.html">ChangeRoot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/use_space.html">use_space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/multiple_ui_elements.html">Multiple ui_elements functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/dynamic_menu.html">Dynamic Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/text_editor_scripts.html">Text Editor Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qr/settings.html">Settings</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/developer.html">Advanced Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/future_update.html">Future Update</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Quick Run Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Duplicator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tuts/duplicator.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="duplicator">
<span id="tut-duplicator"></span><h1>Duplicator<a class="headerlink" href="#duplicator" title="Permalink to this headline">¶</a></h1>
<p>In <a class="reference internal" href="array_modifier.html#tut-array-modifier"><span class="std std-ref">Array Modifier Grid Tutorial</span></a>, we saw how we can create object in Grid.</p>
<p>You can modify that script to create a duplicator. The change that you have to make is, Instead of creating new object
and adding array modifier, duplicate selected object and add modifier on duplicated object.</p>
<p>That script has limitation:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>If you want to use same mesh data. (In viewport, alt D instead of shift D)</p></li>
<li><p>If object has animation or material that you want to handle separately based on situation.</p></li>
</ol>
</div></blockquote>
<p>So, we need a way to duplicate/create objects.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I had written this script as blender addon for an “Animation Nodes” project. If you find it’s settings unintuitive
that’s because it is very project oriented.
The blender operator version of this script is much shorter. Reason being, changing parameters(property) in operators,
undos old operation and redos operation with new parameters. While I can delete and recreate in code too, but I have used simple
‘Object Pool’ <a class="footnote-reference brackets" href="#f1" id="id1">1</a> mechanism.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This script is a bit advanced. This is over 300 lines long, but that is because I have copied some very common
functions related to collection and object creation from a package that I keep in module folder. In my PC I could
have imported that module. Last 100 lines or so is code related to UI creation. ‘Object Pool’ functionality has
taken a lot of lines too.</p>
<p>Most important function is at line 98 <code class="docutils literal notranslate"><span class="pre">onCopiesChanged</span></code> you can go through that and read comments.</p>
<p>last line in <code class="docutils literal notranslate"><span class="pre">ui_elements</span></code> is <code class="docutils literal notranslate"><span class="pre">op.onCancel.append(cleanup)</span></code> which appends <code class="docutils literal notranslate"><span class="pre">cleanup</span></code> function
to delete any remaining extra objects when operator finishes.</p>
<p>This can have bugs.</p>
</div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># &quot;name&quot;: &quot;Duplicates selected objects in Grid&quot;</span>
<span class="c1"># bl_label = &quot;My AN Duplicate Objects in Grid&quot;</span>

<span class="kn">from</span> <span class="nn">boss.ui_creator</span> <span class="kn">import</span> <span class="n">UICreator</span><span class="p">,</span><span class="n">Boss_OT_base_ui</span><span class="p">,</span><span class="n">RectData</span><span class="p">,</span><span class="n">FieldValue</span>
<span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">from</span> <span class="nn">mathutils</span> <span class="kn">import</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">Euler</span><span class="p">,</span> <span class="n">Matrix</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="n">total_copies</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">deleted</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">dict_objsToDelete</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dict_createdObj</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dict_collections</span><span class="p">:</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>


<span class="n">vbf_center</span>                   <span class="p">:</span><span class="kc">None</span>
<span class="n">cb_inNewCollection</span>           <span class="p">:</span><span class="kc">None</span>
<span class="n">cb_collectionUnderScene</span>      <span class="p">:</span><span class="kc">None</span>
<span class="n">vif_copies</span>                   <span class="p">:</span><span class="kc">None</span>
<span class="n">cb_distribution</span>              <span class="p">:</span><span class="kc">None</span>
<span class="n">vff_translate</span>                <span class="p">:</span><span class="kc">None</span>


<span class="k">def</span> <span class="nf">find_collection</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="n">collections</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">users_collection</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">collections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span>

<span class="k">def</span> <span class="nf">make_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">,</span> <span class="n">parent_collection</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">collection_name</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>  <span class="c1"># Does the collection already exist?</span>
        <span class="k">return</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">collection_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_collection</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
        <span class="n">parent_collection</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">new_collection</span><span class="p">)</span>  <span class="c1"># Add the new collection under a parent</span>
        <span class="k">return</span> <span class="n">new_collection</span>


<span class="k">def</span> <span class="nf">delete_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="p">):</span>
    <span class="n">allColls</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span>
    <span class="n">allColls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="n">collection_name</span><span class="p">],</span> <span class="n">do_unlink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">getCollection</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">inNewCollection</span><span class="p">,</span> <span class="n">collectionUnderScene</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb_inNewCollection</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">cb_collectionUnderScene</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span>
    <span class="n">objCollection</span> <span class="o">=</span> <span class="n">find_collection</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

    <span class="c1"># new_collection is the collection where duplicated objects will be</span>
    <span class="c1"># childed.</span>

    <span class="n">new_collection</span> <span class="o">=</span> <span class="n">objCollection</span>

    <span class="k">if</span> <span class="n">inNewCollection</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">collectionUnderScene</span><span class="p">:</span>
            <span class="n">new_collection</span> <span class="o">=</span> <span class="n">make_collection</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_duplicated&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_collection</span> <span class="o">=</span> <span class="n">make_collection</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_duplicated&#39;</span><span class="p">,</span> <span class="n">objCollection</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_collection</span>

<span class="k">def</span> <span class="nf">copyObj</span><span class="p">(</span><span class="n">objToCopy</span><span class="p">,</span> <span class="n">copyMesh</span><span class="p">,</span> <span class="n">copyMat</span><span class="p">,</span> <span class="n">copyAnim</span><span class="p">):</span>
    <span class="n">ob</span> <span class="o">=</span> <span class="n">objToCopy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">copyMesh</span><span class="p">:</span>
        <span class="n">ob</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">copyMat</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">material_slots</span><span class="p">:</span>
            <span class="n">slot</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">copyAnim</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">objToCopy</span><span class="o">.</span><span class="n">animation_data</span> <span class="ow">and</span> <span class="n">objToCopy</span><span class="o">.</span><span class="n">animation_data</span><span class="o">.</span><span class="n">action</span><span class="p">:</span>
            <span class="n">ob</span><span class="o">.</span><span class="n">animation_data</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">objToCopy</span><span class="o">.</span><span class="n">animation_data</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(&#39;object has no animation data&#39;)</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">ob</span>

<span class="k">def</span> <span class="nf">cleanup</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cleanup&#39;</span><span class="p">)</span>
    <span class="n">allObjs</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span>

    <span class="n">renameObjs</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">dict_objsToDelete</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objList</span><span class="p">:</span>
            <span class="n">allObjs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">do_unlink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">renameObjs</span><span class="p">():</span>
    <span class="n">copies</span> <span class="o">=</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">objList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_dupli_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">onCopiesChanged</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">total_copies</span>
    <span class="k">global</span> <span class="n">deleted</span>
    <span class="k">global</span> <span class="n">dict_objsToDelete</span>

    <span class="n">copies</span> <span class="o">=</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">value</span>
    <span class="n">new_total_copies</span> <span class="o">=</span> <span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">new_total_copies</span> <span class="o">&gt;</span> <span class="n">total_copies</span><span class="p">:</span>
        <span class="c1"># new objects will be created.</span>
        <span class="n">objToCreateCnt</span> <span class="o">=</span> <span class="n">new_total_copies</span> <span class="o">-</span> <span class="n">total_copies</span>

        <span class="c1"># check if objects are available in deleted</span>
        <span class="k">if</span> <span class="n">deleted</span> <span class="o">&gt;=</span> <span class="n">objToCreateCnt</span><span class="p">:</span>
            <span class="c1"># enough objects are in deleted dict.</span>
            <span class="c1"># new objects won&#39;t be created.</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">deletedObjList</span><span class="p">),</span> <span class="n">createdObjList</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict_objsToDelete</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">moveToCreated</span> <span class="o">=</span> <span class="n">deletedObjList</span><span class="p">[:</span><span class="n">objToCreateCnt</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">deletedObjList</span><span class="p">[:</span><span class="n">objToCreateCnt</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">mtc</span> <span class="ow">in</span> <span class="n">moveToCreated</span><span class="p">:</span>
                    <span class="n">mtc</span><span class="o">.</span><span class="n">hide_set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">createdObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mtc</span><span class="p">)</span>

            <span class="n">deleted</span> <span class="o">=</span> <span class="n">deleted</span> <span class="o">-</span> <span class="n">objToCreateCnt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not enough objects in deleted</span>
            <span class="c1"># first move all deleted to the created.</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">deletedObjList</span><span class="p">),</span> <span class="n">createdObjList</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict_objsToDelete</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">moveToCreated</span> <span class="o">=</span> <span class="n">deletedObjList</span><span class="p">[:]</span>
                <span class="n">deletedObjList</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">mtc</span> <span class="ow">in</span> <span class="n">moveToCreated</span><span class="p">:</span>
                    <span class="n">mtc</span><span class="o">.</span><span class="n">hide_set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">createdObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mtc</span><span class="p">)</span>

            <span class="n">toCreateMore</span> <span class="o">=</span> <span class="n">objToCreateCnt</span> <span class="o">-</span> <span class="n">deleted</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">coll</span><span class="p">),</span> <span class="n">createdObjList</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict_collections</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">toCreateMore</span><span class="p">):</span>
                    <span class="n">ob</span> <span class="o">=</span> <span class="n">copyObj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="n">ob</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_dupli_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">total_copies</span> <span class="o">+</span> <span class="n">deleted</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">coll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
                    <span class="n">createdObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>

            <span class="n">deleted</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># objects will be destroyed.</span>
        <span class="c1"># number of objects to delete from each object list</span>
        <span class="n">objToDelCnt</span> <span class="o">=</span> <span class="n">total_copies</span> <span class="o">-</span> <span class="n">new_total_copies</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">createdObjList</span> <span class="ow">in</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">createdObjList</span><span class="p">[</span><span class="o">-</span><span class="n">objToDelCnt</span><span class="p">:]</span>

            <span class="k">del</span> <span class="n">createdObjList</span><span class="p">[</span><span class="o">-</span><span class="n">objToDelCnt</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
                <span class="n">t</span><span class="o">.</span><span class="n">hide_set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">dict_objsToDelete</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>


        <span class="n">deleted</span> <span class="o">+=</span> <span class="n">objToDelCnt</span>

    <span class="n">total_copies</span> <span class="o">=</span> <span class="n">new_total_copies</span>

    <span class="n">placeObjects</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">placeObjects</span><span class="p">():</span>
    <span class="n">center</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">translate</span><span class="p">,</span> <span class="n">copies</span> <span class="o">=</span> <span class="p">(</span><span class="n">vbf_center</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">cb_distribution</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">vff_translate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">global</span> <span class="n">dict_createdObj</span>
    <span class="k">global</span> <span class="n">dict_collections</span>

    <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">initLoc</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># gap between objects</span>

        <span class="k">if</span> <span class="n">distribution</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">translate</span>
            <span class="n">initLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">initLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">initLoc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">((</span><span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">translate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">translate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">step</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">translate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">initLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">translate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">initLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">translate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">initLoc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">translate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>


        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">copies</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="c1"># transformations:</span>
                    <span class="n">objList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span>
                    <span class="n">objList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">initLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span>
                    <span class="n">objList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">initLoc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">z</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">onUnderSceneCollectionPressed</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cb_inNewCollection</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cb_collectionUnderScene</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">dict_collections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">objColl</span> <span class="o">=</span> <span class="n">find_collection</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                <span class="n">objColl</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">dict_collections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">objColl</span> <span class="o">=</span> <span class="n">find_collection</span><span class="p">(</span><span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="n">objColl</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">onNewCollectionChanged</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">dict_collections</span>
    <span class="k">global</span> <span class="n">dict_createdObj</span>

    <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">objList</span> <span class="ow">in</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">oldColl</span> <span class="o">=</span> <span class="n">dict_collections</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>
        <span class="n">newColl</span> <span class="o">=</span> <span class="n">getCollection</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">newColl</span> <span class="o">==</span> <span class="n">oldColl</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_collections</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">newColl</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objList</span><span class="p">:</span>
                <span class="n">oldColl</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="n">newColl</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cb_inNewCollection</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delete_collection</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_duplicated&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ui_elements_inGrid</span><span class="p">(</span><span class="n">op</span><span class="p">:</span> <span class="n">Boss_OT_base_ui</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; duplicated selected objects in order in new collection &quot;&quot;&quot;</span>
    <span class="n">ttt_under_scene</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;If collection is not on, then ignored&#39;</span><span class="p">,</span>
    <span class="s1">&#39;otherwise created collection will be under&#39;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;Scene collection&#39; if on, and under object&#39;s&quot;</span><span class="p">,</span>
    <span class="s1">&#39;collection if off &#39;</span>
    <span class="p">)</span>

    <span class="n">objs</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">selected_objects</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;no object selected, select something&#39;</span><span class="p">}</span>

    <span class="k">global</span> <span class="n">vbf_center</span>
    <span class="k">global</span> <span class="n">cb_inNewCollection</span>
    <span class="k">global</span> <span class="n">cb_collectionUnderScene</span>
    <span class="k">global</span> <span class="n">vif_copies</span>
    <span class="k">global</span> <span class="n">cb_distribution</span>
    <span class="k">global</span> <span class="n">vff_translate</span>

    <span class="k">global</span> <span class="n">total_copies</span>
    <span class="k">global</span> <span class="n">dict_createdObj</span>
    <span class="k">global</span> <span class="n">dict_collections</span>

    <span class="n">cc</span> <span class="o">=</span> <span class="n">UICreator</span>
    <span class="n">mouse_x</span><span class="p">,</span><span class="n">mouse_y</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">mouse_xy</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="n">btn_title</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">rectData</span><span class="o">=</span><span class="p">(</span><span class="n">mouse_x</span><span class="p">,</span><span class="n">mouse_y</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;DuplicateGrid&#39;</span><span class="p">)</span>

    <span class="n">cnt</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">vif_copies</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">vectorIntField</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">cnt</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">onCopiesChanged</span><span class="p">,</span>
                                   <span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span> <span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># cb_collectionUnderScene.button.getBottom(5)</span>
    <span class="n">vbf_center</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">vectorBooleanField</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">rectData</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">cnt</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                              <span class="n">onValueChange</span><span class="o">=</span><span class="n">placeObjects</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span><span class="n">rectIsLocal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">cb_inNewCollection</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">checkBox</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">rectData</span><span class="o">=</span><span class="n">vbf_center</span><span class="o">.</span><span class="n">rectData</span><span class="o">.</span><span class="n">getBottom</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;new collection&#39;</span><span class="p">,</span>
                                            <span class="n">ttt</span><span class="o">=</span><span class="s1">&#39;Created objects in new collection&#39;</span><span class="p">,</span>
                                            <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onValueChange</span><span class="o">=</span><span class="n">onNewCollectionChanged</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span><span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># cnt += 1</span>


    <span class="n">cb_collectionUnderScene</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">checkBox</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">rectData</span><span class="o">=</span><span class="n">cb_inNewCollection</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">rectData</span><span class="o">.</span><span class="n">getBottom</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                                                 <span class="n">text</span><span class="o">=</span><span class="s1">&#39;under the scene&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ttt</span><span class="o">=</span><span class="n">ttt_under_scene</span><span class="p">,</span>
                                                 <span class="n">onValueChange</span><span class="o">=</span><span class="n">onUnderSceneCollectionPressed</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span><span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># cnt += 1</span>
    <span class="n">fv</span> <span class="o">=</span> <span class="n">FieldValue</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="nb">min</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="nb">max</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="n">changeBy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">vif_copies</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">vectorIntField</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">cb_collectionUnderScene</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">getBottom</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">fv</span><span class="p">,</span> <span class="n">onCopiesChanged</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span><span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># cnt += 1</span>
    <span class="n">cb_distribution</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">checkBox</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">rectData</span><span class="o">.</span><span class="n">getBottom</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s1">&#39;distribution&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">placeObjects</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span><span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># True is step , false is range</span>

    <span class="c1"># cnt += 1</span>
    <span class="n">vff_translate</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">vectorFloatField</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">cb_distribution</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">getBottom</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="n">placeObjects</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">btn_title</span><span class="p">,</span><span class="n">canDrag</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">total_copies</span> <span class="o">=</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">vif_copies</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># create collections in the beginning</span>

    <span class="n">dict_collections</span> <span class="o">=</span> <span class="p">{</span><span class="n">obj</span> <span class="p">:</span> <span class="n">getCollection</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">}</span>

    <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">o</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">})</span>
    <span class="n">dict_objsToDelete</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">o</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">})</span>

    <span class="c1"># Create new objects and link those to collection</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">coll</span><span class="p">),</span> <span class="n">createdObjList</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dict_collections</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">dict_createdObj</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_copies</span><span class="p">):</span>
            <span class="n">ob</span> <span class="o">=</span> <span class="n">copyObj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">ob</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_dupli_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
            <span class="n">createdObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>

    <span class="c1"># place objects</span>
    <span class="n">placeObjects</span><span class="p">()</span>

    <span class="n">op</span><span class="o">.</span><span class="n">onCancel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>


</pre></div>
</td></tr></table></div>
<p class="rubric">Footnotes:</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Object Pool is a technique, frequently used in games, in which, objects are created/destroyed from a pool of objects.
So, a few objects can be created in the beginning and whenever objects need to be created/deleted they are pulled
from/pushed to that pool. This increases the performance as memory is not freed every time an object is deleted
and then again allocated when object is recreated. So, it’s easy on garbage collector.</p>
</dd>
</dl>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../common/toolTipImages.html" class="btn btn-neutral float-right" title="Tooltip Images" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="turn_around_camera.html" class="btn btn-neutral float-left" title="Turntable Camera" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, bboss99.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>